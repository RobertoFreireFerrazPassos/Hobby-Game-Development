pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
-- platform

function _init()
		state=game
		state:init()
end

function _update()
		state:update()
end

function _draw()
		cls()
		state:draw()
end
-->8
-- states
game={}

function game:init()
		ply:init()
end

function game:update()
		ply:update()
end

function game:draw()
		map()
		ply:draw()
end
-->8
-- player
ply={}

function ply:init(i)
		i = i or 1
		local pt = plytypes[i]
		self.accel = pt.accel   
		self.decel = pt.decel 
		self.maxspeed = pt.maxspeed
		self.spt = pt.spt
		self.jumpforce = pt.jumpforce
		
		self.x = 64
		self.y = 88
		self.vel = 0
		self.type = i		
		self.dy = 0      
  self.onground = true
  self.jump_buffer = 0
  self.jump_buffer_time = 5  
end

function ply:switchtype()
		local i=self.type
		i+=1
		if i > #plytypes then
			i=1
		end
		ply:init(i)
end

function ply:update()
		if btnp(🅾️) then
			ply:switchtype()
		end
		
		-- horizontal movement
		if btn(0) then -- left      
    self.vel = max(self.vel - self.accel, -self.maxspeed)
  elseif btn(1) then -- right      
    self.vel = min(self.vel + self.accel, self.maxspeed)
  else -- decelerate
    if self.vel > 0 then
        self.vel = max(self.vel - self.decel, 0)
    elseif self.vel < 0 then
        self.vel = min(self.vel + self.decel, 0)
    end
  end
  self.x = mid(0, self.x+self.vel, 128)
		
		-- check for jump press and start buffer timer
  if btnp(❎) then
      self.jump_buffer = self.jump_buffer_time
  else
      if self.jump_buffer > 0 then
          self.jump_buffer -= 1
      end
  end
    
		-- jumping
  if self.onground then
      if self.jump_buffer > 0 then
          self.dy = self.jumpforce
          self.onground = false
          self.jump_buffer = 0
      end
  end
  
  -- apply gravity
  if not self.onground then
      self.dy += gravity
      self.y += self.dy
      
      -- ground collision (simple ground at y=88)
      if self.y >= 88 then
          self.y = 88
          self.dy = 0
          self.onground = true
      end
  end
end

function ply:draw()
		spr(self.spt,self.x,self.y)
end

plytypes={
	{ -- light
			accel = 0.25,     
			decel = 0.05,
			maxspeed = 2.0,
			jumpforce= -2.2,
			spt=1
	},
	{ -- inbetween
			accel = 0.2,    
			decel = 0.1,  
			maxspeed = 2.0,
			jumpforce= -2,
			spt=2
	},
	{ -- heavy
			accel = 0.15,   
			decel = 0.15,  
			maxspeed = 2.0,
			jumpforce= -1.8,
			spt=3
	}
}
-->8
-- constant and utils
gravity = 0.3
__gfx__
0000000000ffff000066660000dddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000ffffff0066666600dddddd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700ffffffff66666666dddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000ffffffff66666666dddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000ffffffff66666666dddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700ffffffff66666666dddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000ffffff0066666600dddddd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000ffff000066660000dddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333330000000000044000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
43433434444344340033330000044000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444440333330000044000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444440333333000044000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444440333333000044000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444440033330000044000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444440004400000044000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444440004400000044000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000120000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000120000130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000130000130000120000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000001200130012130012131200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010111010111010101110101110100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
